# nf-proteinsimilarity
A Nextflow wrapper for running PHIST to predict prokaryotic host for bacteriophages.

### Overview
This wrapper performs the following steps:
1. Splits the `--host_file` input CSV into chunks containing `--chunk_size` bacterial FastA files (URLs).
2. Downloads FastA files from the URLs specified in each chunk.
3. Runs PHIST on each chunk, using the `--virus_fasta` as the virus file.
4. Deletes downloaded bacterial FastA files after they have been run through PHIST to limit disk usage.
5. Combines PHIST outputs from each chunk into the `--output` CSV file.

### Quick start
In addition to automated downloads and cleanup (limiting disk requirements), this wrapper also makes setup very easy.

First, install Conda/Mamba/Micromamba/Pixi
*Example Micromamba installation*
```
"${SHELL}" <(curl -L micro.mamba.pm/install.sh)
```

Then create a Nextflow environment
```
micromamba create -n nextflow -c conda-forge -c bioconda nextflow -y
```

Activate the Nextflow environemtn
```
micromamba activate nextflow
```

Then just run the pipeline!
```
nextflow run CarsonJM/nf-proteinsimilarity -profile test,<docker/singularity/conda/mamba>
```

### Usage
The only arguments for this tool are:

`--virus_fasta`: Path (or URL) to a FastA file of viral genomes.

`--host_file`: Path (or URL) to a TXT file of containing paths (or URLs) to host FastA files.

`--chunk_size`: Number (Integer) of host sequences contained in each chunk (default: 10,000)

`--output`: Path to output TSV file containing information on all spacer-virus hits.

### Output
The only output of this wrapper is the common k-mers table generated by PHIST
```csv
kmer-length: 25 fraction: 1 ,db-samples ,MGV-GENOME-0246745,MGV-GENOME-0258256,MGV-GENOME-0287285,NC_005258.1,NC_024123.1,NC_024215.1,NC_024330.1,NC_024369.2,NC_024375.1,NC_024379.1,
query-samples,total-kmers,36185,38091,43611,14911,63558,54285,37356,41544,67073,39022,
GUT_GENOME233927.fna,2102071,2:38042,
GUT_GENOME012545.fna,1915135,2:38042,
GUT_GENOME018220.fna,2855800,3:11,
```

### Credits
This wrapper was made by @CarsonJM. However, primary credit of course goes to the PHIST developers (https://github.com/refresh-bio/PHIST), and their work should be cited if this wrapper is used (https://doi.org/10.1093/bioinformatics/btab837)